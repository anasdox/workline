project:
  id: example
  kind: software-project

attestations:
  catalog:
    requirements.accepted:
      description: "Team agreed on scope and requirements"
    design.reviewed:
      description: "Solution/design reviewed"
    scope.groomed:
      description: "Task is sized, dependencies known"
    ci.passed:
      description: "CI pipeline completed successfully"
    review.approved:
      description: "Code review approved"
    acceptance.passed:
      description: "Acceptance criteria validated"
    security.ok:
      description: "Security checks passed"
    iteration.approved:
      description: "Iteration approved"
    workshop.discovery.completed:
      description: "Discovery workshop completed"
    workshop.problem_refinement.completed:
      description: "Problem refinement workshop completed"
    workshop.eventstorming.completed:
      description: "Event storming workshop completed"
    workshop.decision.completed:
      description: "Decision workshop completed"
    workshop.clarify.completed:
      description: "Clarification workshop completed"

policies:
  presets:
    ready:
      require: [requirements.accepted, design.reviewed, scope.groomed]

    done.standard:
      require: [ci.passed, review.approved, acceptance.passed]

    done.bugfix:
      require: [ci.passed, review.approved]

    low:
      require: [ci.passed, review.approved]

    medium:
      require: [ci.passed, review.approved]

    high:
      require: [ci.passed, review.approved, security.ok]

    workshop.discovery:
      require: [workshop.discovery.completed]

    workshop.problem_refinement:
      require: [workshop.problem_refinement.completed]

    workshop.eventstorming:
      require: [workshop.eventstorming.completed]

    workshop.decision:
      require: [workshop.decision.completed]

    workshop.clarify:
      require: [workshop.clarify.completed]

  defaults:
    task:
      feature: done.standard
      bug: done.bugfix
      technical: done.standard
      docs: low
      chore: low
      workshop: workshop.problem_refinement

    iteration:
      validation:
        require: iteration.approved

rbac:
  roles:
    owner:
      description: "Project owner"
      permissions:
        - project.create
        - project.list
        - project.read
        - project.update
        - project.delete
        - project.config.read
        - project.status.read
        - project.events.read
        - task.create
        - task.list
        - task.read
        - task.tree
        - task.validation.read
        - task.update
        - task.done
        - task.claim
        - task.release
        - iteration.create
        - iteration.list
        - iteration.set_status
        - decision.create
        - attestation.add
        - attestation.list
        - rbac.manage
        - force.use
    observer:
      description: "Read-only observer"
      permissions:
        - project.list
        - project.read
        - project.config.read
        - project.status.read
        - project.events.read
        - task.list
        - task.read
        - task.tree
        - task.validation.read
        - iteration.list
        - attestation.list
  attestation_authorities:
    ci.passed: [owner]
    review.approved: [owner]
    acceptance.passed: [owner]
    security.ok: [owner]
    iteration.approved: [owner]
    workshop.discovery.completed: [owner]
    workshop.problem_refinement.completed: [owner]
    workshop.eventstorming.completed: [owner]
    workshop.decision.completed: [owner]
    workshop.clarify.completed: [owner]
